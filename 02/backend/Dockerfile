FROM openjdk:11.0.3-jre-stretch

ARG ENV=production
ARG DB_IP
ARG DB_PORT
ARG DB_NAME
ARG DATABASE_TYPE
ARG DB_USERNAME
ARG DB_PASSWORD
# ARG KEYSTORE
# ARG KEYSTORE_STORE_PASSWORD
# ARG KEYSTORE_KEY_PASSWORD
# ARG KEYSTORE_ALIAS

ENV DATABASE_IP $DB_IP
ENV DATABASE_PORT $DB_PORT
ENV SPRING_PROFILES_ACTIVE $ENV
ENV SPRING_JPA_DATABASE ${DATABASE_TYPE}
ENV SPRING_DATASOURCE_URL "jdbc:${DATABASE_TYPE}://${DB_IP}:${DB_PORT}/${DB_NAME}"
ENV SPRING_DATASOURCE_USERNAME $DB_USERNAME
ENV SPRING_DATASOURCE_PASSWORD $DB_PASSWORD
# ENV KEYCLOAK_KEYSTORE ${KEYSTORE}
# ENV KEYSTORE_STORE_PASSWORD $KEYSTORE_STORE_PASSWORD
# ENV KEYSTORE_KEY_PASSWORD $KEYSTORE_KEY_PASSWORD
# ENV KEYSTORE_ALIAS $KEYSTORE_ALIAS

COPY target/demo-backend.jar /home/demo-backend.jar
COPY wait-for-it.sh /home
EXPOSE 8080

CMD ["/home/wait-for-it.sh", "$DATABASE_IP:$DATABASE_PORT","-t","5","--", "java", "-jar", "/home/demo-backend.jar"]